<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
        PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
        "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="stateMachine">

    <select id="selectMachineModel" parameterClass="map" resultClass="com.lufax.foudation.statemachine.fsm.model.StateMachineModel">
        select
         ID id ,
         BIZ_REF_NO     bizRefNo,
         BIZ_TYPE bizType ,
         CURRENT_STATE      currentState ,
         CREATED_BY createdBy,
         MODIFIED_BY ,
         CREATED_DATE createdDate
         MODIFIED_DATE modifiedDate,
         IS_DONE isDone,
         VERSION version,
         ATTEMPCOUNT attempCount
        from STATEMACHINE_MODEL
        where 1=1

        <isNotEmpty prepend="and" property="ID">
            ID = #id#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="bizRefNo">
            BIZ_REF_NO = #bizRefNo#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="bizType">
            BIZ_TYPE = #bizType#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="currentState">
            CURRENT_STATE = #currentState#
        </isNotEmpty>

    </select>



    <insert id="insertMachineModel" parameterClass="com.lufax.foudation.statemachine.fsm.model.StateMachineModel">

        insert into STATEMACHINE_MODEL(
        ID,
        BIZ_REF_NO,
        BIZ_TYPE,
        CURRENT_STATE,
        CREATED_BY,
        MODIFIED_BY,
        CREATED_DATE,
        MODIFIED_DATE,
        IS_DONE,
        VERSION,
        ATTEMPCOUNT
        )VALUES(
        #id#,
        #bizRefNo#,
        #bizType#,
        #currentState#,
        #createdBy#,
        #modifiedBy#,
        now(),
        now(),
        #isDone#,
        #version#,
        #attempCount#,

        )
    </insert>



    <update id="updateMachineModel" parameterClass="java.util.Map">
        update STATEMACHINE_MODEL set



        <isNotEmpty prepend="and" property="isDone">
            isDone = #isDone#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="currentState">
            CURRENT_STATE = #currentState#
        </isNotEmpty>

            modifiedDate =now()

            where   ID = #id#

    </update>



</sqlMap>
